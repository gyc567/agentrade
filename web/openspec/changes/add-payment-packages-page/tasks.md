# 实现任务清单

## 1. 组件开发

- [ ] 1.1 创建 `components/PricingCard.tsx` 套餐卡片组件
  - [ ] 1.1.1 支持套餐信息展示（名称、价格、积分）
  - [ ] 1.1.2 支持推荐徽章（badge）和高亮颜色
  - [ ] 1.1.3 积分计算和展示（基础 + 赠送 = 总计）
  - [ ] 1.1.4 响应式 CSS（移动优先）
  - [ ] 1.1.5 单元测试（`PricingCard.test.tsx`）

- [ ] 1.2 创建 `hooks/usePricingData.ts` 数据获取 Hook
  - [ ] 1.2.1 从 `/api/v1/credit-packages` 获取套餐列表
  - [ ] 1.2.2 缓存策略（React Query + 5 分钟 TTL）
  - [ ] 1.2.3 错误处理和 fallback 到硬编码常量
  - [ ] 1.2.4 国际化支持（中英文）
  - [ ] 1.2.5 单元测试（`usePricingData.test.ts`）

- [ ] 1.3 创建 `constants/pricing-content.ts` 文案常量
  - [ ] 1.3.1 套餐特性列表（功能、区块链支持）
  - [ ] 1.3.2 FAQ 常见问题
  - [ ] 1.3.3 中英文翻译

## 2. 页面实现

- [ ] 2.1 创建 `/pages/pricing.tsx` 页面
  - [ ] 2.1.1 使用 `usePricingData()` 获取套餐数据
  - [ ] 2.1.2 使用 `PricingCard` 组件展示套餐列表
  - [ ] 2.1.3 套餐对比表格（功能、区块链）
  - [ ] 2.1.4 "立即购买" 按钮 → 触发 `PaymentModal`
  - [ ] 2.1.5 Skeleton Loading 和错误处理
  - [ ] 2.1.6 单元测试（`pricing.test.tsx`）
  - [ ] 2.1.7 E2E 测试（Playwright）

- [ ] 2.2 添加页面路由
  - [ ] 2.2.1 在路由配置中添加 `/pricing` 路由
  - [ ] 2.2.2 添加导航链接（Header / Sidebar）

## 3. 类型系统更新

- [ ] 3.1 修改 `types/payment.ts`
  - [ ] 3.1.1 改 `id: "starter" | "pro" | "vip"` → `id: string`
  - [ ] 3.1.2 更新相关的 TypeScript 类型引用
  - [ ] 3.1.3 确保所有引用编译通过

- [ ] 3.2 更新 `constants/packages.ts`
  - [ ] 3.2.1 保留硬编码常量作为 fallback
  - [ ] 3.2.2 添加注释说明用途

- [ ] 3.3 更新 `services/paymentValidator.ts`
  - [ ] 3.3.1 `validatePackageId()` 改为后端验证
  - [ ] 3.3.2 保留客户端的基础验证（长度、格式）

## 4. PaymentModal 兼容性

- [ ] 4.1 验证 `PaymentModal` 与动态套餐的兼容性
  - [ ] 4.1.1 确保 PaymentModal 接受动态套餐数据
  - [ ] 4.1.2 确保没有硬编码的套餐 ID 检查
  - [ ] 4.1.3 单元测试验证兼容性

- [ ] 4.2 验证 `PaymentOrchestrator` 无需改动
  - [ ] 4.2.1 确认所有 API 调用都用字符串 packageId
  - [ ] 4.2.2 检查没有类型检查 hardcode 了套餐 ID

## 5. 国际化支持

- [ ] 5.1 设置 i18n 翻译文件
  - [ ] 5.1.1 `locales/zh-CN.json` 中文文案
  - [ ] 5.1.2 `locales/en-US.json` 英文文案
  - [ ] 5.1.3 套餐名称、特性、按钮文案

- [ ] 5.2 集成到 i18n 系统
  - [ ] 5.2.1 在 PricingCard 中使用 `useTranslation()`
  - [ ] 5.2.2 在 /pricing 页面中使用翻译

## 6. 测试

- [ ] 6.1 单元测试
  - [ ] 6.1.1 `PricingCard.test.tsx` - 组件渲染、props 传递
  - [ ] 6.1.2 `usePricingData.test.ts` - API 调用、缓存、fallback
  - [ ] 6.1.3 `pricing.test.tsx` - 页面渲染、交互

- [ ] 6.2 集成测试
  - [ ] 6.2.1 测试 `/pricing` → PaymentModal 的流程
  - [ ] 6.2.2 测试中英文切换

- [ ] 6.3 E2E 测试 (Playwright)
  - [ ] 6.3.1 访问 `/pricing` 页面
  - [ ] 6.3.2 验证套餐卡片正确显示
  - [ ] 6.3.3 点击 "立即购买" 打开 PaymentModal
  - [ ] 6.3.4 选择套餐并支付（模拟 mock）

## 7. 样式和 UI 优化

- [ ] 7.1 响应式设计
  - [ ] 7.1.1 手机 (< 640px): 单列布局
  - [ ] 7.1.2 平板 (640px-1024px): 两列布局
  - [ ] 7.1.3 桌面 (> 1024px): 三列布局

- [ ] 7.2 无障碍访问 (a11y)
  - [ ] 7.2.1 ARIA 标签正确
  - [ ] 7.2.2 键盘导航支持
  - [ ] 7.2.3 颜色对比度检查（WCAG AA）

- [ ] 7.3 性能优化
  - [ ] 7.3.1 图片懒加载
  - [ ] 7.3.2 组件 memoization（React.memo）
  - [ ] 7.3.3 Lighthouse 检查 (LCP < 2.5s)

## 8. 错误处理和降级

- [ ] 8.1 API 失败处理
  - [ ] 8.1.1 网络超时 → 使用硬编码常量
  - [ ] 8.1.2 404 错误 → 显示错误提示
  - [ ] 8.1.3 500 错误 → 建议用户重试

- [ ] 8.2 容错测试
  - [ ] 8.2.1 模拟 API 超时
  - [ ] 8.2.2 模拟网络错误
  - [ ] 8.2.3 验证 fallback 正确工作

## 9. 文档和代码审查

- [ ] 9.1 文档
  - [ ] 9.1.1 更新 `features/payment/README.md`
  - [ ] 9.1.2 添加 `/pricing` 页面使用说明
  - [ ] 9.1.3 补充 API 集成文档

- [ ] 9.2 代码审查
  - [ ] 9.2.1 代码风格检查 (ESLint)
  - [ ] 9.2.2 类型检查 (TypeScript strict mode)
  - [ ] 9.2.3 安全审查（防 XSS、CSRF 等）

## 10. 验收和上线

- [ ] 10.1 最终验收
  - [ ] 10.1.1 功能测试：所有场景覆盖
  - [ ] 10.1.2 性能测试：加载时间符合预期
  - [ ] 10.1.3 兼容性测试：主流浏览器

- [ ] 10.2 上线准备
  - [ ] 10.2.1 环境配置确认
  - [ ] 10.2.2 A/B 测试计划（可选）
  - [ ] 10.2.3 上线后监控方案

---

## 进度跟踪

**开始日期**: YYYY-MM-DD
**预计完成**: YYYY-MM-DD

| 阶段 | 任务数 | 完成数 | 进度 |
|------|--------|--------|------|
| 组件开发 | 5 | 0 | 0% |
| 页面实现 | 2 | 0 | 0% |
| 类型系统 | 3 | 0 | 0% |
| 兼容性验证 | 2 | 0 | 0% |
| 国际化 | 2 | 0 | 0% |
| 测试 | 3 | 0 | 0% |
| UI/UX | 3 | 0 | 0% |
| 错误处理 | 2 | 0 | 0% |
| 文档和审查 | 2 | 0 | 0% |
| 验收上线 | 2 | 0 | 0% |
| **总计** | **26** | **0** | **0%** |

---

## 注意事项

1. **类型改动**: 改 `PackageId` 类型时，需要确保所有引用都兼容
2. **向后兼容**: 保留硬编码常量作为 fallback，确保即使 API 失败也能显示
3. **国际化**: 完整的中英文翻译是必须的
4. **测试覆盖**: 目标 80% 以上，重点覆盖 API 失败、国际化切换等边界情况
5. **性能**: 套餐加载时间应 < 1s（包括网络）
