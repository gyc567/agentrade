# OpenSpec Proposal: 支付套餐展示页面

## 变更 ID
`add-payment-packages-page`

## 为什么

当前支付功能已实现核心的交易流程（Crossmint SDK 集成、PaymentOrchestrator 编排），但**缺少用户面向的套餐展示页面**。用户无法在应用中看到可购买的积分套餐，只能通过模态框隐式选择。

**业务背景**：
- 数据库已定义三个标准套餐（Starter/Pro/VIP）
- 前端常量也定义了这三个套餐的价格和积分
- 用户需要一个清晰的**套餐展示和对比页面**，帮助他们做出购买决策

**架构现状**：
- 后端 API `/api/v1/credit-packages` 可动态获取套餐
- 前端只有模态框支付 UI，没有套餐列表展示
- 代码中硬编码了套餐，无法充分利用后端的动态能力

## 改什么

### ADDED 功能

1. **新页面**: `/pages/pricing` - 支付套餐展示页面
   - 展示三个套餐（Starter/Pro/VIP）
   - 套餐卡片设计：价格、积分、赠送比例、推荐徽章
   - 对比表格：功能特性、支持的区块链
   - "立即购买" 按钮 → 触发 PaymentModal

2. **新组件**: `PricingCard.tsx`
   - 单个套餐卡片组件
   - 支持推荐徽章（HOT / BEST SAVE）
   - 响应式设计（移动 / 平板 / 桌面）
   - 积分计算和展示（基础 + 赠送）

3. **新 Hook**: `usePricingData()`
   - 从后端动态获取套餐列表
   - 本地缓存，5 分钟 TTL
   - 支持中英文国际化

4. **新常量**: `pricing-content.ts`
   - 套餐特性文案（中英文）
   - 支持的区块链列表
   - 常见问题 (FAQ)

### MODIFIED 功能

1. **`types/payment.ts`**: PackageId 类型改为字符串
   ```typescript
   // FROM: id: "starter" | "pro" | "vip"
   // TO: id: string
   ```
   - **理由**: 支持后端动态套餐管理
   - **兼容性**: PaymentModal 和 PaymentOrchestrator 无需改动（已用字符串）

2. **`components/PaymentModal.tsx`**: 支持动态套餐
   - 改为从 `usePricingData()` 获取套餐列表
   - 保持向后兼容（固定套餐和动态套餐都支持）

3. **路由配置**: 新增 `/pricing` 页面路由

### REMOVED 功能

无移除项（保持向后兼容）

## 影响

### 受影响的模块

- **前端页面**: `/pages/pricing`（新增）
- **类型系统**: `types/payment.ts`（字符串替代硬编码联合类型）
- **API 集成**: 新增对 `/api/v1/credit-packages` 的调用
- **路由**: 新增 `/pricing` 路由

### 现有功能影响

- ✅ **PaymentModal**: 无改动，继续支持（可从常量或传入的 package 数据）
- ✅ **PaymentOrchestrator**: 无改动
- ✅ **支付流程**: 无改动

### 向后兼容性

- 类型改为 `id: string` 时，现有的 `"starter" | "pro" | "vip"` 仍然有效
- 代码中的硬编码检查（`validatePackageId`）需要改为后端验证

## 风险分析

| 风险 | 概率 | 影响 | 缓解方案 |
|------|------|------|---------|
| 后端 API 故障 | 低 | 页面不能加载套餐 | 使用硬编码常量作为 fallback |
| 类型改动导致 TS 编译错误 | 中 | 其他模块编译失败 | 谨慎改动，确保所有引用都兼容 |
| 网络较慢导致页面加载慢 | 低 | 用户体验差 | 添加 Loading Skeleton，预加载 |
| 国际化文案缺失 | 低 | 英文用户看不懂 | 提供完整的中英文文案 |

## 设计决策

1. **动态套餐 vs 硬编码**
   - ✅ **选择**: 动态获取 + 硬编码 fallback
   - **理由**: 后端已支持动态管理，前端应充分利用。同时保留 fallback 增强稳定性。

2. **页面路由**
   - ✅ **选择**: `/pricing` 独立页面
   - **理由**: 清晰的 URL 结构，SEO 友好，便于分享

3. **缓存策略**
   - ✅ **选择**: React Query + 5 分钟 TTL
   - **理由**: 减少服务端压力，快速加载，支持离线浏览

4. **组件复用**
   - ✅ **选择**: PricingCard 可用于其他场景
   - **理由**: 提高代码复用率

## 成功标准

- ✅ `/pricing` 页面正确渲染三个套餐卡片
- ✅ 积分计算准确（基础 + 赠送 = 总计）
- ✅ "立即购买" 按钮打开 PaymentModal
- ✅ 支持中英文切换
- ✅ 响应式设计在手机上可用
- ✅ TypeScript 无编译错误
- ✅ 单元测试覆盖 80% 以上

## 实施计划

**总耗时**: 约 4-6 小时

1. **第一步** (1.5h): 创建 PricingCard 组件和 usePricingData Hook
2. **第二步** (1.5h): 创建 `/pricing` 页面，集成套餐卡片
3. **第三步** (1h): 修改类型系统，确保兼容性
4. **第四步** (1h): 添加国际化支持和错误处理
5. **第五步** (1h): 单元测试和 E2E 测试
6. **第六步** (0.5h): 文档更新和代码审查

## 后续步骤

1. ⏳ 审批本提案
2. ⏳ 实施并测试
3. ⏳ 代码审查
4. ⏳ 上线部署
